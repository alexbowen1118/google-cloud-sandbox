<?phpextract($_REQUEST);//echo "<pre>"; print_r($_REQUEST); echo "</pre>";  exit;include("../../include/iConnect.inc");// database connection parameters$database="fuel";  $db = mysqli_select_db($connection,$database)       or die ("Couldn't select database");// if($level<4){exit;}$skip=array("year","month","center_code");// FIELD NAMES are stored in $fieldArray$sql = "SHOW COLUMNS FROM form_b";//echo "$sql";$result = mysqli_query($connection,$sql) or die ("Couldn't execute query SHOW2.");while ($row=mysqli_fetch_assoc($result))	{	$rf=$row['Field'];	$fieldArray[]=$rf;	if(in_array($rf,$skip)){continue;}	$field_list.="sum($rf) as $rf,";	}//echo "<pre>"; print_r($fieldArray); echo "</pre>";  //exit;$field_list=rtrim($field_list,",");if($rep=="x")	{	header('Content-Type: application/vnd.ms-excel');	header('Content-Disposition: attachment; filename=form_B.xls');	}	$sql= "SELECT center_code,$field_list from form_b 	where year='$pass_year' 	group by center_code";	$result = mysqli_query($connection,$sql) or die ("Couldn't execute query.");			while($row=mysqli_fetch_assoc($result))			{			$ARRAY[]=$row;			}//	echo "$sql"; exit;//	echo "<pre>"; print_r($ARRAY); echo "</pre>";  exit;		$title=$pass_year."_Form_A";		$header_array[]=array_keys($ARRAY[0]);		header("Content-Type: text/csv");		header("Content-Disposition: attachment; filename=$title.csv");		// Disable caching		header("Cache-Control: no-cache, no-store, must-revalidate"); // HTTP 1.1		header("Pragma: no-cache"); // HTTP 1.0		header("Expires: 0"); // Proxies			function outputCSV($header_array, $data)			{				$output = fopen("php://output", "w");				foreach ($header_array as $row) {					fputcsv($output, $row); // here you can change delimiter/enclosure				}				foreach ($data as $row) {					fputcsv($output, $row); // here you can change delimiter/enclosure				}				fclose($output);			}		outputCSV($header_array, $ARRAY);		exit;				// echo "<table border='1' cellpadding='5'>";// 	// // // Table headers// 	echo "<tr><th></th>// 	<th colspan='7'  bgcolor='aliceblue'>Agricultural Equipment<br />(Farm Tractor, Combine)</th>// 	<th colspan='7'>Heavy / Construction Equipment<br />(fulltrack, backhoe, grader, dozer)</th>// 	<th colspan='7'  bgcolor='aliceblue'>Small Offroad Vehicles<br />(ATV, mule, gator, golfcart, snowmobile, riding mower)</th>// 	<th colspan='7'>Utility<br />(fork lift, manlift)</th>// 	<th colspan='7'  bgcolor='aliceblue'>Other<br />(push mower, power tools, blowers, generators)</th>// 	<th colspan='7'>Boats</th>// 	</tr>";// 	// 	echo "<tr><th><a href=form_B_yr_total.php?pass_year=$pass_year&rep=x>Excel</a></th>// 	<th colspan='7'>Gallons</th>// 	<th colspan='7'>Gallons</th>// 	<th colspan='7'>Gallons</th>// 	<th colspan='7'>Gallons</th>// 	<th colspan='7'>Gallons</th>// 	<th colspan='7'>Gallons</th>// 	</tr>";// 	// $row_header=array("unl_3","unl_5");// 	echo "<tr><th><font color='blue'>$pass_year</font></th>";// 			foreach($fieldArray as $k1=>$v1){// 				if(in_array($v1,$skip)){continue;}// 				$var=explode("_",strtoupper($v1));// 				echo "<th>&nbsp;&nbsp;$var[0]&nbsp;&nbsp;</th>";// 				}// 	echo "</tr>";// // // // Data entry// //echo "<pre>"; print_r($fieldArray); echo "</pre>"; // exit;// 	foreach($ARRAY as $k=>$v){// 	extract($v);// 	if(fmod($k,2)==0){$tr=" bgcolor='aliceblue'";}else{$tr="";}// 		echo "<tr$tr><th>$center_code</th>";// 			foreach($fieldArray as $k1=>$v1)// 				{// 				if(in_array($v1,$skip)){continue;}// 				$value=${$v1};// 				echo "<td align='right'>$value</td>";// 				${"tot_".$v1}+=$value;// 				}// 		echo "</tr>";// 		}// //echo "<pre>a"; print_r($tot_unl_1); echo "</pre>"; // exit;// echo "<tr><th>Total</th>";// 	// 	foreach($fieldArray as $k1=>$v1){// 				if(in_array($v1,$skip)){continue;}// 				$var=${"tot_".$v1};// 				if($var=="0"){$var="-";}else{$var=number_format($var,1);}// 				echo "<th bgcolor='yellow'>$var</th>";// 				}// echo "</tr>";// // echo "</table></html>";?>