<?phpini_set('display_errors',1);date_default_timezone_set('America/New_York');$database="annual_pass";include_once("../_base_top.php");// includes session_start();include("../../include/iConnect.inc");// database connection parameters// include("../../include/get_parkcodes_reg.php");// database connection parametersmysqli_select_db($connection,$database) or die ("Couldn't select database $database");// echo "<pre>"; print_r($_POST); echo "</pre>"; // exit;//************ FORM ****************//TABLE$TABLE="passes";//************ ACTION ****************d$where="";if(@$submit=="Search")	{	$skip=array("submit","submit_form");	$exact=array("pass_number");// 	echo "<pre>"; print_r($_POST); echo "</pre>"; // exit;	foreach($_POST as $fld=>$value)		{		if(empty($value)){continue;}		if(in_array($fld, $skip)){continue;}				if(in_array($fld, $exact))			{			$temp[]="$fld = '$value'";			}			else			{			$temp[]="$fld like '%$value%'";			}					}	$where="where ".implode(" and ",$temp);	}//************ FORM ****************$sql="SELECT distinct year FROM  $TABLE order by year desc";  //echo "$sql";$result = @mysqli_QUERY($connection,$sql);$year_array=array();while($row=mysqli_fetch_assoc($result))	{	$year_array[]=$row['year'];	}// get parks with passes$sql="SELECT distinct issuing_park FROM  $TABLE order by issuing_park";  //echo "$sql";$result = @mysqli_QUERY($connection,$sql);$parkCode_array=array();while($row=mysqli_fetch_assoc($result))	{	$parkCode_array[]=$row['issuing_park'];	}// echo "<pre>"; print_r($parkCode_array); echo "</pre>"; // exit;// get type_pass$sql="SELECT distinct type_pass FROM  $TABLE order by type_pass";  //echo "$sql";$result = @mysqli_QUERY($connection,$sql);$sub_type_pass_array=array();while($row=mysqli_fetch_assoc($result))	{	$type_pass_array[]=$row['type_pass'];	}// get sub_type_pass$sql="SELECT distinct sub_type_pass FROM  $TABLE order by issuing_park";  //echo "$sql";$result = @mysqli_QUERY($connection,$sql);$sub_type_pass_array=array();while($row=mysqli_fetch_assoc($result))	{	$sub_type_pass_array[]=$row['sub_type_pass'];	}// if(!in_array("FOFI_FWD", $sub_type_pass_array)){$sub_type_pass_array[]="FOFI_FWD";}// echo "<pre>"; print_r($year_array); echo "</pre>"; // exit;// ********** Get Field Types *********$sql="SHOW COLUMNS FROM  $TABLE";  //echo "$sql";$result = @mysqli_QUERY($connection,$sql);while($row=mysqli_fetch_assoc($result))	{	$allFields[]=$row['Field'];	$allTypes[]=$row['Type'];	if(strpos($row['Type'],"decimal")>-1){		$decimalFields[]=$row['Field'];		$tempVar=explode(",",$row['Type']);		$decPoint[$row['Field']]=trim($tempVar[1],")");		}	if(strpos($row['Type'],"char")>-1 || strpos($row['Type'],"varchar")>-1){		$charFields[]=$row['Field'];		$tempVar=explode("(",$row['Type']);		$charNum[$row['Field']]=trim($tempVar[1],")");		}	if(strpos($row['Type'],"text")>-1){		$textFields[]=$row['Field'];		}	if(strpos($row['Type'],"date")>-1){		$charNum[$row['Field']]="16";		}	if(strpos($row['Type'],"int")>-1){		$charNum[$row['Field']]="16";		}	}//print_r($charNum);// ******** Show Form here **********// $exclude=array("id");$exclude=array("id");$rename=array("quick_link"=>"Link for Comments","comment"=>"any additional info");$include=array_diff($allFields,$exclude);//echo "<pre>";print_r($allFields); print_r($include);echo "</pre>";echo "<table class='table' border='1' cellpadding='5'>";echo "<tr><th colspan='2'>NC State Parks Annual / Seasonal Passes</th></tr>";if(!empty($error_array))	{	echo "<pre>"; print_r($error_array); echo "</pre>"; // exit;	}echo "<form method='POST' action='search.php'>";// $type_pass_array=array("Annual","Seasonal","FOFI_FWD");foreach($include as $k=>$v)	{	$type=$allTypes[$k];	if(array_key_exists($v,$rename)){$r=$rename[$v];}else{$r=$v;}	$r=strtoupper(str_replace("_"," ",$r));	$value="";	if(!empty($id))		{$value=${$v};}		if($type=="text")		{		$line="<tr><th align='right'>$r</th><td><textarea name='$v' cols='50' rows='5'>$value</textarea></td></tr>";		}		else		{		$size=$charNum[$v];		if($v=="year"){$value=date("Y");}		if($value==2017){$value=2018;}		$com="";		if($v=="pass_number")			{$com="<font size='2'> Must be exact pass number, e.g., F0204 or P21-00003</a></font>";}			if($v=="name")			{			$size=25;			$com="<font size='2'> Can be any part of name, e.g., First or Last Name</a></font>";			}		$line="<tr><th align='right'>$r</th>		<td><input type='text' name='$v' value=\"$value\" size='$size'> $com</td></tr>";				if($v=="type_pass")			{			$line="<tr><th align='right'>$r</th><td><select name=$v> <option value=\"\" selected></option>\n";			foreach($type_pass_array as $k1=>$v1)				{				$line.="<option value=$v1>$v1</option>?n";				}			$line.="</select> <font size='2'>Values for this field have varied over the years.</font></td></tr>";			}		if($v=="sub_type_pass")			{			$line="<tr><th align='right'>$r</th><td><select name=$v> <option value=\"\" selected></option>\n";			foreach($sub_type_pass_array as $k1=>$v1)				{				if(empty($v1)){continue;}				$line.="<option value=$v1>$v1</option>?n";				}			$line.="</select></td></tr>";			}					if($v=="issuing_park")			{// 			array_unshift($parkCode_array, "ARCH");// echo "<pre>"; print_r($parkCode_array); echo "</pre>"; // exit;			$line="<tr><th align='right'>$r</th><td><select name=$v> <option value=\"\" selected></option>\n";			foreach($parkCode_array as $k1=>$v1)				{				if($v1==@$issuing_park){$s="selected";}else{$s="";}				$line.="<option value=$v1 $s>$v1</option>?n";				}			$line.="</select></td></tr>";			}			if($v=="year")			{			$line="<tr><th align='right'>$r</th><td><select name=$v> <option value=\"\" selected></option>\n";			foreach($year_array as $k1=>$v1)				{				if($v1==@$year){$s="selected";}else{$s="";}				$line.="<option value=$v1 $s>$v1</option>?n";				}			$line.="</select></td></tr>";			}		if($v=="date_issued")			{			$line="<tr><th align='right'>$r</th><td><input type='text' id='datepicker1' name='$v' value=\"$value\" size='$size'></td></tr>";			}		if($v=="void")			{			$line="<tr><th align='right'>$r</th><td><input type='checkbox' name='$v' value=\"x\"></td></tr>";			}		}	echo "$line";	}if(empty($id)){$action="Search";}else{$action="Update";}echo "<tr><td colspan='2' align='center'><input type='submit' name='submit' value='$action'></td></tr>";echo "</form></table>";if(!empty($_POST))	{// echo "<pre>"; print_r($_POST); echo "</pre>"; // exit;	$limit="";	$skip=array("submit","submit_form");	foreach($_POST as $k=>$v)		{		if(in_array($k, $skip)){continue;}		$sort_array_fld[]="<input type='hidden' name='$k' value=\"$v\">";		}	}	else	{	exit;	}// 	, lpad(pass_number, 5, '0') as pad_number$order_by="order by pass_number desc, issuing_park ";if(!empty($submit_form))	{	if($submit_form=="date_issued"){$s="desc";}else{$s="asc";}	$order_by="order by $submit_form $s ";	}	$sql="SELECT * FROM  $TABLE $where	$order_by	$limit ";// 	echo "$sql";	$result = @mysqli_QUERY($connection,$sql);	while($row=mysqli_fetch_assoc($result))		{		$ARRAY[]=$row;		}if(empty($ARRAY)){exit;}$i=0;		$c=count($ARRAY);$sort_array=array("date_issued","pass_number");		if($c>10 and $limit="")			{$c="Most recent 10 shown";}			else			{$c.=" passes";}		echo "<table class='table' border='1' cellpadding='5'>";		echo "<tr><th colspan='11'>$c</th></tr>";		foreach($ARRAY AS $index=>$array)			{			$i++;			if($index==0)				{				echo "<tr><th>Edit</th>";				foreach($ARRAY[0] AS $fld=>$value)					{					if(in_array($fld,$exclude)){continue;}					$var_fld=$fld;					if(in_array($fld, $sort_array))						{						$var_fld="<form method='post' action='search.php'>";						foreach($sort_array_fld as $k=>$v)							{							$var_fld.=$v;							}						$var_fld.="<input type='hidden' name='submit' value=\"Search\">";						$var_fld.="<input type='submit' name='submit_form' value=\"$fld\">						</form>";						}					echo "<th>$var_fld</th>";					}				echo "</tr>";				}			if($array['type_pass']=="Family")				{$tr="<tr style='background-color:#d6d6c2'>";}				else				{$tr="<tr style='background-color:#ebebe0'>";}						if($array['void']=="x")				{$tr="<tr style='background-color:#ffcccc'>";}				echo "$tr";			foreach($array as $fld=>$value)				{				if($fld=="id"){echo "<td><form action='action.php' method='POST'>				<input type='hidden' name='edit' value=\"$value\">				<input type='submit' name='submit' value=\"$i\">				</form></td>";}								if(in_array($fld,$exclude)){continue;}				if($fld=="comments")					{					strlen($value)>25?$value=substr($value,0,5)."...":$value;					}				echo "<td valign='top'>$value</td>";				}			echo "</tr>";			}		echo "</table>";echo "</body></html>";?>